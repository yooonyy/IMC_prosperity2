# IMC-Prosperity-2024, Y-FoRM
[ENG. ver link]()

## IMC Prosperity란?
- IMC Prosperity는 IMC Trading에서 주최하는 17일간의 알고리즘 및 메뉴얼 트레이딩 대회입니다.
- 가상 시장은 SeaShells라는 가상 화폐단위와 Strawberrie와 같은 제품이 거래되는 군도로 설정되어있습니다.
- 알고리즘 트레이딩의 경우, 파이썬 파일을 제출하여 limit order book에서 봇과 거래합니다.
- 올해의 주제는 마켓 메이킹, OTC 트레이딩, 바스켓 트레이딩, 옵션 트레이딩을 포함했습니다.
- 수동 트레이딩의 경우, 수학과 게임 이론에 관한 트레이딩 결정과 관련된 퍼즐이 주어집니다.

## 주요 참고 링크
- [IMC Prosperity](https://prosperity.imc.com)
- [Prosperity Wiki](https://imc-prosperity.notion.site/Prosperity-2-Wiki-fe650c0292ae4cdb94714a3f5aa74c85)
- [jmerle](https://github.com/jmerle)에게 별도의 감사를 표합니다.
- 그는 오픈소스 도구들인 [Visualizer](https://jmerle.github.io/imc-prosperity-2-visualizer/)와 [Backtester](https://github.com/jmerle/imc-prosperity-2-backtester/tree/master)는 대회참여자 모두에게 큰 도움을 주었습니다.

---

## 결과
### 최종 순위: 전체 189위 (상위 2%), 한국 5위

| 순위    | 전체 | 메뉴얼 | 알고리즘 | 국가 |
| ------ | ------- | ------ | ----------- | ------- |
| 라운드 1 | 1913    | 2263   | 674         | 12      |
| 라운드 2 | 290     | 1397   | 292         | 6       |
| 라운드 3 | 279     | 971    | 280         | 6       |
| 라운드 4 | 212     | 794    | 199         | 5       |
| 라운드 5 | 189     | 576    | 177         | 5       |

| 손익     | 메뉴얼  | 알고리즘 | 전체 | 누적 |
| ------- | ------- | ----------- | ------- | ---------- |
| 라운드 1 | 68,531  | 22,124      | 90,655  | 90,655     |
| 라운드 2 | 113,938 | 219,146     | 333,085 | 423,740    |
| 라운드 3 | 75,107  | 49,707      | 124,814 | 548,555    |
| 라운드 4 | 52,212  | 282,865     | 335,077 | 883,632    |
| 라운드 5 | 69,785  | 108,109     | 177,895 | 1,061,527  |

---

## 팀 Y-FoRM
저희는 연세대학교의 학부생들로 구성된 팀이며, 2명은 산업공학 전공, 1명은 경제학 전공입니다.
또한 저희 팀 이름에서 알 수 있듯이, 저희는 연세대학교 금융공학 및 리스크 관리 학회 [Y-FoRM](https://yform.co.kr/)의 학회원입니다.

- 임지섭 [LinkedIn](https://www.linkedin.com/in/jimmylim0823/)
- 조성윤 [LinkedIn](https://www.linkedin.com/in/seongyun0727/)
- 박상현 [LinkedIn](https://www.linkedin.com/in/sang-hyeon-park-84612a271/)

---
## 라운드 요약
1. [모든 라운드에 공통적인 고려사항](#모든-라운드에-공통적인-고려사항)
1. [튜토리얼 라운드: 마켓 메이킹](#튜토리얼-라운드-마켓-메이킹)
1. [라운드 1: 마켓 메이킹 (이어짐)](#라운드-1-마켓-메이킹-이어짐)
1. [라운드 2: OTC 트레이딩 (거래소-OTC 차익거래)](#라운드-2-OTC-트레이딩-거래소-OTC-차익거래)
1. [라운드 3: 바스켓 트레이딩 (NAV 트레이딩)](#라운드-3-바스켓-트레이딩-NAV-트레이딩)
1. [라운드 4: 옵션 트레이딩 (베가 트레이딩)](#라운드-4-옵션-트레이딩-베가-트레이딩)
1. [라운드 5: 비익명화된 거래 데이터](#라운드-5-비익명화된-거래-데이터)

### 모든 라운드에 공통적인 고려사항
- 주문장부(Order book)가 있지만, 동시에 작동하는 것이 아니라 차례로 운영됩니다 (보드 게임과 같은 턴제로 진행).
- 모든 주문은 각 시점이 지나면 취소되고 다음 타임스탬프로 재처리됩니다.
- 모든 제품은 각가의 포지션 수량 제한을 가지며, 거래량과 금액 가치로 잠재적인 손익이 결정됩니다.
- 주문이 포지션 수량 제한에 도달할 가능성이 있다면, 주문은 취소될 것이므로 주문 크기를 제한해야 합니다.
- 스크립트는 AWS에서 실행되며, 작년에는 복잡한 알고리즘을 가진 많은 팀이 Lambda 문제를 겪었습니다. (ML,DL 사용 불가)
- AWS에서는 클래스 변수가 손실될 수 있지만, `traderData`를 통해 타임스탬프 간에 직렬화된 데이터를 전달할 수 있습니다.
- Prosperity 서버가 다운되는 경우가 두 번 있었으며, 그럴 경우 대회는 24시간 연장되었습니다.
- 이전 라운드의 제품은 시장에 남아 있지만, 시장의 흐름은 변할 수 있습니다.

### 튜토리얼 라운드: 마켓 메이킹
저희는 튜토리얼에서 [트레이딩 코드](https://imc-prosperity.notion.site/Writing-an-Algorithm-in-Python-658e233a26e24510bfccf0b1df647858)의 메커니즘과 구조를 이해하는 데 대부분의 시간을 보냈습니다.
결국 저희는 공정 가치를 중심으로 시장을 만들고 포지션 제한을 고려한 손절매를 결정했습니다.

**관찰된 몇 가지 사항**
- 두 제품 모두에서 주문장부에는 주로 두 명의 에이전트가 있었습니다:
    - 매우 수동적인 마켓 메이커: 중간가격에서 +-5의 크고 대칭적인 주문을 제시합니다 (항상 worst).
    - 적극적인 트레이더 (noise or informed): 더 작고 비대칭적인 크기로 +-5 주문을 밑도는 주문을 합니다.
- 포지션 제한은 불리한 선택에 반하여 재고 관리에 일정 부분 기여합니다.
    - 인벤토리가 특정 방향으로 쌓이게 되면 해당 방향의 최대 허용 주문 크기가 감소합니다.
    - 우리는 불리한 측면에서 주문 크기를 더 줄여 자신을 보호할 수 있었습니다.

**마켓 메이킹 (MM) 로직**
1. 상품의 공정 가치(FV) 업데이트
1. 공정 가치 또는 그 이하로 평가된 주문에 market taking 진행 (worst 매수/매도 호가에는 주문을 넣지 않음)
1. 인벤토리가 특정 수준 이상으로 쌓일 경우 손절매(stop loss) (worst 매수/매도 호가에는 주문을 넣지 않음)
1. FV 부근에서 재고를 고려한 최대 주문 크기를 통해 시장을 조성

**Amethesis(상품1)**
- FV는 명확히 10k이며 중간가격은 매우 안정적(10k +- 2), 따라서 우리는 고정된 FV인 10k를 사용했습니다.
- 위의 마켓 메이킹 로직을 그대로 적용하였으며, FV 업데이트는 필요하지 않았습니다.

**Starfruit(상품2)**
- 가격에는 추세(강한 드리프트)가 있으며 하루 동안에 추세가 반전됨을 데이터에서 파악하였습니다.
- 저희는 롤링 선형 회귀(Rolling Linear Regression) $P_t=\beta_0+\beta_1 t$를 사용하여 다음 타임스탬프의 가격을 예측했습니다 $\hat{P_{t+1}}=\hat{\beta_0}+\hat{\beta_0}(t+1)$.
- [SOBI](https://www.cis.upenn.edu/~mkearns/projects/sobi.html) (정적 주문장부 불균형)를 활용하여 주문장부의 중간가격(mid price)이 아닌 중간-vwap을 데이터 큐에 저장했습니다. 이렇게 하면 소량의 최우선 매수/매도에 잡음이 있을 때 이를 제거할 수 있다고 판단하였습니다.
- 또한 저희는 heat map와 그래프를 활용하여 다양한 rolling window size를 탐색하며 최적의 예측 window를 찾았습니다.
